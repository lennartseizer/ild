My Page
================

Preprocessing can be organized along a reproducible workflow: (1)
understand the study design, (2) reliably import the raw data, (3)
validate measurement windows, (4) classify missing and problematic
observations, (5) compute scales and derived variables, (6) generate the
analysis dataset for the target model (e.g., LMM). Each step should be
documented in scripts to ensure that the analyses remain transparent and
reproducible.

``` r
library(dplyr)
library(ggplot2)
```

``` r
# load example data
data <- read.delim("https://www.kuleuven.be/samenwerking/real/real-book/viechtbauer2022_data_esmda_example")

dplyr::tibble(data)
```

    ## # A tibble: 19,680 × 27
    ##    id      age sex    status    day  beep   obs beeptime resptime resphour
    ##    <chr> <int> <chr>  <chr>   <int> <int> <int>    <int>    <int>    <dbl>
    ##  1 c100     30 female control     1     1     1      477      480      8  
    ##  2 c100     30 female control     1     2     2      585       NA     NA  
    ##  3 c100     30 female control     1     3     3      718      721     12.0
    ##  4 c100     30 female control     1     4     4      756      759     12.6
    ##  5 c100     30 female control     1     5     5      874      876     14.6
    ##  6 c100     30 female control     1     6     6      982      988     16.5
    ##  7 c100     30 female control     1     7     7     1079     1082     18.0
    ##  8 c100     30 female control     1     8     8     1133     1138     19.0
    ##  9 c100     30 female control     1     9     9     1215     1219     20.3
    ## 10 c100     30 female control     1    10    10     1301     1304     21.7
    ## # ℹ 19,670 more rows
    ## # ℹ 17 more variables: tothours <dbl>, mood_cheerf <int>, mood_relaxed <int>,
    ## #   mood_satisfi <int>, mood_irritat <int>, mood_anxious <int>,
    ## #   mood_down <int>, mood_guilty <int>, mood_insecur <int>, mood_lonely <int>,
    ## #   eventpl <int>, soc_alone <int>, soc_pleasant <int>, act_else <int>,
    ## #   use_coffee <int>, use_alcohol <int>, location <chr>

**Design variables**: the study `day` (1 to 6), the `beep` number within
each day (1 to 10) and `beeptime` (in minutes after midnight) on each
day, the overall number of observations `obs` (1 to 60), the response
time `resptime` (in minutes after midnight)

**Subject-level, time-invariant variables**: the participants’ `age` (in
years), `sex` (female, male), and mental health `status` (control,
depressed, psychotic)

**Time-varying response variables**: 3 items to assess positive affect
and 6 items to assess negative affect (1 to 7 Likert scale), the
pleasantness of events that had occurred since the previous beep
`eventpl` (−3 to +3 bipolar scale), whether the person was alone at the
time of the beep `soc_alone` (1 = alone, 0 = not alone) and when the
person was not alone) a rating how pleasant the company is
`soc_pleasant` (1 to 7 Likert scale), and whether they had consumed
coffee / alcohol since the previous beep (1 = yes, 0 = no)

# Design and sampling scheme

``` r
# number of participants
length(unique(data$id))
```

    ## [1] 328

``` r
# number of planned observations 
nrow(data)
```

    ## [1] 19680

``` r
# missing values in design variables?
```

``` r
# variance in time-invariant variables?
vars <- c("age", "sex", "status")

data %>%
  group_by(id) %>%
  summarise(across(all_of(vars), ~ n_distinct(.) == 1), .groups = "drop") %>%
  summarise(across(all_of(vars), all))
```

    ## # A tibble: 1 × 3
    ##   age   sex   status
    ##   <lgl> <lgl> <lgl> 
    ## 1 TRUE  TRUE  TRUE

``` r
# investigate further
data %>%
  group_by(id) %>%
  summarise(across(all_of(vars), n_distinct)) %>%
  mutate(across(all_of(vars), ~ .x == 1))
```

    ## # A tibble: 328 × 4
    ##    id    age   sex   status
    ##    <chr> <lgl> <lgl> <lgl> 
    ##  1 c100  TRUE  TRUE  TRUE  
    ##  2 c101  TRUE  TRUE  TRUE  
    ##  3 c102  TRUE  TRUE  TRUE  
    ##  4 c103  TRUE  TRUE  TRUE  
    ##  5 c104  TRUE  TRUE  TRUE  
    ##  6 c105  TRUE  TRUE  TRUE  
    ##  7 c106  TRUE  TRUE  TRUE  
    ##  8 c107  TRUE  TRUE  TRUE  
    ##  9 c108  TRUE  TRUE  TRUE  
    ## 10 c109  TRUE  TRUE  TRUE  
    ## # ℹ 318 more rows

# Participants response behaviors

``` r
# compute the response frequencies
data$compl <- !is.na(data$resptime)

# histogram of the response frequencies
hist(aggregate(data, compl ~ id, sum)$compl, main = "Response Frequency",
     col="lightgray", xlab="Number of assessments", right=FALSE)
```

![](2_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

``` r
# histogram of the compliance
hist(aggregate(data, compl ~ id, sum)$compl / 60, main = "Response Frequency",
     col="lightgray", xlab="Percentage of assessments", right=FALSE)
```

![](2_files/figure-gfm/unnamed-chunk-7-2.png)<!-- -->

``` r
# summary of compliance
summary(aggregate(data, compl ~ id, sum)$compl / 60)
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ##  0.3333  0.6500  0.7750  0.7567  0.8833  1.0000

``` r
# compute response delays
data$delay <- data$resptime - data$beeptime

# barplot of the delay values
barplot(table(data$delay), xlab="Delay in Minutes")
```

![](2_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

# Compute and transform variables

``` r
# compute scales of positive and negative affect
data$pa <- rowMeans(data[,c("mood_cheerf", "mood_relaxed", "mood_satisfi")])

data$na <- rowMeans(data[,c("mood_irritat", "mood_anxious", "mood_down", 
                            "mood_guilty", "mood_insecur", "mood_lonely")])
```

``` r
# separate variables into within and between parts

# positive affect
data$pa_b <- ave(data$pa, data$id, FUN=function(x)mean(x, na.rm = TRUE)) # person-mean (between)
data$pa_w <- data$pa - data$pa_b # person-mean centered (within)

# negative affect
data$na_b <- ave(data$na, data$id, FUN=function(x)mean(x, na.rm = TRUE)) # person-mean (between)
data$na_w <- data$na - data$na_b # person-mean centered (within)

tibble(data[,c("id","pa","pa_b","pa_w")])
```

    ## # A tibble: 19,680 × 4
    ##    id       pa  pa_b   pa_w
    ##    <chr> <dbl> <dbl>  <dbl>
    ##  1 c100   4.67  5.12 -0.452
    ##  2 c100  NA     5.12 NA    
    ##  3 c100   5.33  5.12  0.215
    ##  4 c100   4     5.12 -1.12 
    ##  5 c100   4.33  5.12 -0.785
    ##  6 c100   5     5.12 -0.119
    ##  7 c100   4     5.12 -1.12 
    ##  8 c100   5.33  5.12  0.215
    ##  9 c100   5     5.12 -0.119
    ## 10 c100   4.33  5.12 -0.785
    ## # ℹ 19,670 more rows

# visualization

``` r
id_select <- "c100"

data %>% filter(id %in% id_select) %>%
     ggplot(aes(x = obs, y = pa)) +
     geom_line() +
     geom_point() +
     facet_grid(id ~ ., scales = "free") 
```

    ## Warning: Removed 15 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

![](2_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->

``` r
id_select <- c("c100", "c101", "c102", "c103", "c104")

data %>% filter(id %in% id_select) %>%
     ggplot(aes(x=obs, y=mood_relaxed)) +
     geom_line() +
     geom_point() +
     facet_grid(id~., scales="free") 
```

    ## Warning: Removed 41 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

![](2_files/figure-gfm/unnamed-chunk-12-1.png)<!-- -->

``` r
# plot within and between parts
data %>% filter(id %in% id_select) %>%
     ggplot(aes(x = obs, y = pa_b)) +
     geom_line() +
     geom_point() 
```

![](2_files/figure-gfm/unnamed-chunk-14-1.png)<!-- -->

``` r
data %>% filter(id %in% id_select) %>%
     ggplot(aes(x = obs, y = pa_w)) +
     geom_line() +
     geom_point() 
```

    ## Warning: Removed 42 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

![](2_files/figure-gfm/unnamed-chunk-14-2.png)<!-- -->

# References & Further reading
