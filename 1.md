My Page
================

Preprocessing can be organized along a reproducible workflow: (1)
understand the study design, (2) reliably import the raw data, (3)
validate measurement windows, (4) classify missing and problematic
observations, (5) compute scales and derived variables, (6) generate the
analysis dataset for the target model (e.g., LMM). Each step should be
documented in scripts to ensure that the analyses remain transparent and
reproducible.

<figure>
<img src="https://www.researchgate.net/profile/Sheen-Levine/publication/325941519/figure/fig2/AS:824194581422080@1573514709439/The-Datasaurus-Dozen-Matejka-Fitzmaurice-2017-an-extension-of-Anscombes-quartet.ppm" alt="The Datasaurus Dozen">
<figcaption style="color: gray; font-size: 0.8em;">
The Datasaurus Dozen (Matejka & Fitzmaurice, 2017) – an extension of
Anscombe’s quartet.
</figcaption>
</figure>

# Set environment

    ## Installing package into '/home/runner/work/_temp/Library'
    ## (as 'lib' is unspecified)
    ## Installing package into '/home/runner/work/_temp/Library'
    ## (as 'lib' is unspecified)

<figure>
<img src="https://swcarpentry.github.io/r-novice-gapminder/fig/14-tidyr-fig3.png">  
<figcaption style="color: gray; font-size: 0.8em;">
From wide to long format with pivot_longer().
</figcaption>
</figure>

``` r
# load packages
library(dplyr)
library(ggplot2)

# load example data
data <- read.delim("https://www.kuleuven.be/samenwerking/real/real-book/viechtbauer2022_data_esmda_example")
str(data)
```

    ## 'data.frame':    19680 obs. of  27 variables:
    ##  $ id          : chr  "c100" "c100" "c100" "c100" ...
    ##  $ age         : int  30 30 30 30 30 30 30 30 30 30 ...
    ##  $ sex         : chr  "female" "female" "female" "female" ...
    ##  $ status      : chr  "control" "control" "control" "control" ...
    ##  $ day         : int  1 1 1 1 1 1 1 1 1 1 ...
    ##  $ beep        : int  1 2 3 4 5 6 7 8 9 10 ...
    ##  $ obs         : int  1 2 3 4 5 6 7 8 9 10 ...
    ##  $ beeptime    : int  477 585 718 756 874 982 1079 1133 1215 1301 ...
    ##  $ resptime    : int  480 NA 721 759 876 988 1082 1138 1219 1304 ...
    ##  $ resphour    : num  8 NA 12 12.7 14.6 ...
    ##  $ tothours    : num  8 NA 12 12.7 14.6 ...
    ##  $ mood_cheerf : int  5 NA 6 4 5 6 4 6 5 4 ...
    ##  $ mood_relaxed: int  4 NA 5 4 4 4 4 5 5 4 ...
    ##  $ mood_satisfi: int  5 NA 5 4 4 5 4 5 5 5 ...
    ##  $ mood_irritat: int  1 NA 1 6 2 6 4 2 1 1 ...
    ##  $ mood_anxious: int  1 NA 1 1 1 1 1 1 1 1 ...
    ##  $ mood_down   : int  1 NA 1 6 1 1 1 1 1 1 ...
    ##  $ mood_guilty : int  1 NA 1 1 1 1 1 1 1 1 ...
    ##  $ mood_insecur: int  1 NA 1 1 1 1 1 1 1 1 ...
    ##  $ mood_lonely : int  1 NA 1 1 1 1 1 1 1 1 ...
    ##  $ eventpl     : int  0 NA 2 -2 3 NA 3 NA 3 2 ...
    ##  $ soc_alone   : int  0 NA 0 0 0 0 0 0 0 0 ...
    ##  $ soc_pleasant: int  7 NA 7 7 7 4 6 7 7 7 ...
    ##  $ act_else    : int  2 NA 1 7 2 7 6 3 1 7 ...
    ##  $ use_coffee  : int  0 NA 0 0 0 1 0 0 0 0 ...
    ##  $ use_alcohol : int  0 NA 0 0 0 0 0 0 0 0 ...
    ##  $ location    : chr  "home" "" "home" "home" ...

``` r
# compute scales of positive and negative affect
data$pa <- rowMeans(data[,c("mood_cheerf", "mood_relaxed", "mood_satisfi")])

data$na <- rowMeans(data[,c("mood_irritat", "mood_anxious", "mood_down", "mood_guilty", "mood_insecur", "mood_lonely")])
```

# Design and sampling scheme

Number of subjects and planned observations

``` r
length(unique(data$id))
```

    ## [1] 328

``` r
nrow(data)
```

    ## [1] 19680

Missing values in design variables?

``` r
vars <- c("age", "sex")

data %>%
  group_by(id) %>%
  summarise(across(all_of(vars), n_distinct)) %>%
  mutate(across(all_of(vars), ~ .x == 1))
```

    ## # A tibble: 328 × 3
    ##    id    age   sex  
    ##    <chr> <lgl> <lgl>
    ##  1 c100  TRUE  TRUE 
    ##  2 c101  TRUE  TRUE 
    ##  3 c102  TRUE  TRUE 
    ##  4 c103  TRUE  TRUE 
    ##  5 c104  TRUE  TRUE 
    ##  6 c105  TRUE  TRUE 
    ##  7 c106  TRUE  TRUE 
    ##  8 c107  TRUE  TRUE 
    ##  9 c108  TRUE  TRUE 
    ## 10 c109  TRUE  TRUE 
    ## # ℹ 318 more rows

# Participants response behaviors

``` r
# compute response delays
data$delay <- data$resptime - data$beeptime

# barplot of the delay values
barplot(table(data$delay), xlab="Delay in Minutes")
```

![](1_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

![](1_files/figure-gfm/unnamed-chunk-7-1.png)<!-- --> \![Distribution of
response delays\]({{ ‘/assets/plots/delay-distribution.svg’ \|
relative_url }})

``` r
# compute the response frequencies
data$compl <- as.numeric(complete.cases(data))

# histogram of the response frequencies
hist(aggregate(data, compl ~ id, sum)$compl, 
     col="lightgray", xlab="Response Frequency", right=FALSE)
```

![](1_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

# Compute and transform variables

between and within

``` r
# positive affect
data$pa_b <- ave(data$pa, data$id, FUN = mean) # person-mean (between)
data$pa_w <- data$pa - data$pa_b # person-mean centered (within)

# negative affect
data$na_b <- ave(data$na, data$id, FUN = mean) # person-mean (between)
data$na_w <- data$na - data$na_b # person-mean centered (within)


tibble(data[,c("id","pa","pa_b","pa_w")])
```

    ## # A tibble: 19,680 × 4
    ##    id       pa  pa_b  pa_w
    ##    <chr> <dbl> <dbl> <dbl>
    ##  1 c100   4.67    NA    NA
    ##  2 c100  NA       NA    NA
    ##  3 c100   5.33    NA    NA
    ##  4 c100   4       NA    NA
    ##  5 c100   4.33    NA    NA
    ##  6 c100   5       NA    NA
    ##  7 c100   4       NA    NA
    ##  8 c100   5.33    NA    NA
    ##  9 c100   5       NA    NA
    ## 10 c100   4.33    NA    NA
    ## # ℹ 19,670 more rows

# First glimpse

``` r
id_select <- c("c100", "c101", "c102", "c103", "c104")

data %>% filter(id %in% id_select) %>%
     ggplot(aes(x=obs, y=mood_relaxed)) +
     geom_line() +
     geom_point() +
     facet_grid(id~., scales="free") 
```

    ## Warning: Removed 41 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

![](1_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->

# References & Further reading

Matejka, J., & Fitzmaurice, G. 2017. Same stats, different graphs:
Generating datasets with varied appearance andidentical statistics
through simulated annealing. Paper presented at the CHI 2017, Denver,
CO, USA.
