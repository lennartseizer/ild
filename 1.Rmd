---
title: "My Page"
output:
  html_document:
    df_print: paged
    self_contained: no
  word_document: default
  pdf_document: default
---

Preprocessing can be organized along a reproducible workflow: (1) understand the study design, (2) reliably import the raw data, (3) validate measurement windows, (4) classify missing and problematic observations, (5) compute scales and derived variables, (6) generate the analysis dataset for the target model (e.g., LMM). Each step should be documented in scripts to ensure that the analyses remain transparent and reproducible. 

```{r, message=FALSE}
library(dplyr)
library(ggplot2)
```

```{r, message=FALSE}
# load example data
data <- read.delim("https://www.kuleuven.be/samenwerking/real/real-book/viechtbauer2022_data_esmda_example")

dplyr::tibble(data)
```


# Design and sampling scheme

Number of subjects and planned observations 
```{r}
length(unique(data$id))
nrow(data)
```

Missing values in design variables?
```{r}

```

```{r, message=FALSE}
vars <- c("age", "sex")

data %>%
  group_by(id) %>%
  summarise(across(all_of(vars), n_distinct)) %>%
  mutate(across(all_of(vars), ~ .x == 1))
```

# Participants response behaviors

```{r}
# compute response delays
data$delay <- data$resptime - data$beeptime

# barplot of the delay values
barplot(table(data$delay), xlab="Delay in Minutes")
```

```{r}
# compute the response frequencies
data$compl <- as.numeric(complete.cases(data))

# histogram of the response frequencies
hist(aggregate(data, compl ~ id, sum)$compl, 
     col="lightgray", xlab="Response Frequency", right=FALSE)
```


# Compute and transform variables

```{r}
# compute scales of positive and negative affect
data$pa <- rowMeans(data[,c("mood_cheerf", "mood_relaxed", "mood_satisfi")])

data$na <- rowMeans(data[,c("mood_irritat", "mood_anxious", "mood_down", "mood_guilty", "mood_insecur", "mood_lonely")])
```

between and within
```{r}
# positive affect
data$pa_b <- ave(data$pa, data$id, FUN=function(x)mean(x, na.rm = TRUE)) # person-mean (between)
data$pa_w <- data$pa - data$pa_b # person-mean centered (within)

# negative affect
data$na_b <- ave(data$na, data$id, FUN=function(x)mean(x, na.rm = TRUE)) # person-mean (between)
data$na_w <- data$na - data$na_b # person-mean centered (within)

tibble(data[,c("id","pa","pa_b","pa_w")])
```

# visualization

```{r, message=FALSE}
id_select <- "c100"

data %>% filter(id %in% id_select) %>%
     ggplot(aes(x = obs, y = pa)) +
     geom_line() +
     geom_point() +
     facet_grid(id ~ ., scales = "free") 
```

```{r, message=FALSE}
id_select <- c("c100", "c101", "c102", "c103", "c104")

data %>% filter(id %in% id_select) %>%
     ggplot(aes(x=obs, y=mood_relaxed)) +
     geom_line() +
     geom_point() +
     facet_grid(id~., scales="free") 
```



# References & Further reading

