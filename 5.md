Power analysis
================

There are several approaches to conduct power analyses for LMMs in
`R`:  
- **simr**: Simulation-based function to estimate power of LMMs.  
- **mlpwr**: ML algorithm to find the optimal sample size and number of
time points.  
- **PowerAnalysisLM**: A Shiny app for (longitudinal) LLMs that account
for temporal dependencies in multi-level data.

# Example using `simr`:

``` r
# load package
library(simr)

# seed
set.seed(123)

# create design data
id <- factor(1:20)
time <- 1:7
group <- c("control", "intervention")

data <- data.frame(id = rep(id, each = length(time)),
                   time = rep(time, length(id)),
                   group = rep(rep(group, each = length(time)), 
                               length(id)/2))

head(data, n = 20)
```

    ##    id time        group
    ## 1   1    1      control
    ## 2   1    2      control
    ## 3   1    3      control
    ## 4   1    4      control
    ## 5   1    5      control
    ## 6   1    6      control
    ## 7   1    7      control
    ## 8   2    1 intervention
    ## 9   2    2 intervention
    ## 10  2    3 intervention
    ## 11  2    4 intervention
    ## 12  2    5 intervention
    ## 13  2    6 intervention
    ## 14  2    7 intervention
    ## 15  3    1      control
    ## 16  3    2      control
    ## 17  3    3      control
    ## 18  3    4      control
    ## 19  3    5      control
    ## 20  3    6      control

``` r
# intercept and slopes for group, time, and group:time
fixed <- c(5, 0, 0.1, 0.2)

# random intercepts (variance)
rand <- list(0.5)

# residual (standard deviation)
res <- 2
```

``` r
# fit model
model <- makeLmer(y ~ group*time + (1|id),
                  fixef=fixed, VarCorr=rand, sigma=res, data=data)
summary(model)
```

    ## Linear mixed model fit by REML ['lmerMod']
    ## Formula: y ~ group * time + (1 | id)
    ##    Data: data
    ## 
    ## REML criterion at convergence: 626.5
    ## 
    ## Scaled residuals: 
    ##      Min       1Q   Median       3Q      Max 
    ## -2.74517 -0.69081 -0.01938  0.68411  2.25890 
    ## 
    ## Random effects:
    ##  Groups   Name        Variance Std.Dev.
    ##  id       (Intercept) 0.5      0.7071  
    ##  Residual             4.0      2.0000  
    ## Number of obs: 140, groups:  id, 20
    ## 
    ## Fixed effects:
    ##                        Estimate Std. Error t value
    ## (Intercept)              5.0000     0.5794   8.629
    ## groupintervention        0.0000     0.8194   0.000
    ## time                     0.1000     0.1195   0.837
    ## groupintervention:time   0.2000     0.1690   1.183
    ## 
    ## Correlation of Fixed Effects:
    ##             (Intr) grpntr time  
    ## gropntrvntn -0.707              
    ## time        -0.825  0.583       
    ## grpntrvntn:  0.583 -0.825 -0.707

``` r
# power analysis
sim <- powerSim(model, nsim = 100, test = fcompare(y ~ time))
```

``` r
sim
```

    ## Power for model comparison, (95% confidence interval):
    ##       49.00% (38.86, 59.20)
    ## 
    ## Test: Likelihood ratio
    ##       Comparison to y ~ time + [re]
    ## 
    ## Based on 100 simulations, (1 warning, 0 errors)
    ## alpha = 0.05, nrow = 140
    ## 
    ## Time elapsed: 0 h 0 m 7 s

``` r
# changing the number of participants
model_ext_id <- extend(model, along = "id", n = 50)
p_curve <- powerCurve(model_ext_id, nsim = 100, 
                      test = fcompare(y~time), 
                      along = "id", 
                      breaks = c(10, 20, 30, 40, 50))
```

``` r
plot(p_curve)
```

![](5_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

``` r
# changing the number of timepoints
model_ext_time <- extend(model, within = "group+id", n = 28)
p_curve <- powerCurve(model_ext_time, nsim = 100, 
                      test = fcompare(y ~ time), 
                      within = "group+id", 
                      breaks = c(7, 14, 21, 28))
```

``` r
plot(p_curve)
```

![](5_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->

``` r
# changing both the number of participants and timepoints
model_ext_all <- extend(model, along = "id", n = 40)
model_ext_all <- extend(model, within = "group+id", n = 14)

sim <- powerSim(model_ext_all, nsim = 100, test = fcompare(y ~ time))
```

``` r
sim
```

    ## Power for model comparison, (95% confidence interval):
    ##       69.00% (58.97, 77.87)
    ## 
    ## Test: Likelihood ratio
    ##       Comparison to y ~ time + [re]
    ## 
    ## Based on 100 simulations, (0 warnings, 0 errors)
    ## alpha = 0.05, nrow = 280
    ## 
    ## Time elapsed: 0 h 0 m 7 s
