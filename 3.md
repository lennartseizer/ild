---
layout: page
title: Mixed-effects model
output: md_document
---

## Multilevel Models for Emotion Time Series

# Mixed-Effects Models – von OLS zu LME/LMM

> Kopier‑fertige Formeln (MathJax) mit Farblegende für feste und zufällige Effekte – ideal für Folien und Handouts in Markdown.

---

### Legende
- **Feste Effekte (β)**: <span style="color:#4f46e5">blau</span>  
- **Zufällige Effekte (b)**: <span style="color:#059669">grün</span>  
- **Fehler / Residuen (ε)**: <span style="color:#ef4444">rot</span>  
- **Designmatrizen (X, Z)**: <span style="color:#374151">grau</span>  

---

### 1) Klassisches lineares Modell (OLS)

\[
\underbrace{\mathbf y}_{\text{Antwort}}
= \underbrace{\color{gray}{\mathbf X}}_{\text{Design}}
\, \underbrace{\color{blue}{\boldsymbol\beta}}_{\text{feste Effekte}}
+ \underbrace{\color{red}{\boldsymbol\varepsilon}}_{\varepsilon \sim \mathcal N(\mathbf 0,\, \sigma^2\mathbf I)}
\]

Die gesamte systematische Struktur steckt in $\color{#4f46e5}{\boldsymbol\beta}$; die Varianz ist homogen: $\sigma^2$.

---

### 2) Lineares Mixed-Effects-Modell

$$
\mathbf y = \color{#374151}{\mathbf X}\,\color{#4f46e5}{\boldsymbol\beta} + \color{#374151}{\mathbf Z}\,\color{#059669}{\mathbf b} + \color{#ef4444}{\boldsymbol\varepsilon}
$$

$$
\color{#059669}{\mathbf b} \sim \mathcal N(\mathbf 0, \mathbf G), \quad \color{#ef4444}{\boldsymbol\varepsilon} \sim \mathcal N(\mathbf 0, \mathbf R)
$$

- $\color{#374151}{\mathbf Z}\,\color{#059669}{\mathbf b}$ erlaubt gruppenspezifische Abweichungen (z. B. Personen, Klassen, Items).
- Typisch: $\mathbf R = \sigma^2\mathbf I$; $\mathbf G$ kann diagonal (RI) oder voll (RI+RS) sein.

---

### 3) Beispiele

**Zufälliger Interzept (RI):**

$$
y_{ij} = \color{#4f46e5}{\beta_0} + \color{#4f46e5}{\beta_1}x_{ij} + \color{#059669}{b_{0j}} + \color{#ef4444}{\varepsilon_{ij}}
$$

$$
\color{#059669}{b_{0j}} \sim \mathcal N(0, \sigma^2_{b0}), \quad \color{#ef4444}{\varepsilon_{ij}} \sim \mathcal N(0, \sigma^2)
$$

Formel (lme4): `y ~ 1 + x + (1 | gruppe)`

---

**Zufälliger Interzept & Steigung (RI+RS):**

$$
y_{ij} = (\color{#4f46e5}{\beta_0}+\color{#059669}{b_{0j}}) + (\color{#4f46e5}{\beta_1}+\color{#059669}{b_{1j}})x_{ij} + \color{#ef4444}{\varepsilon_{ij}}
$$

$$
\begin{bmatrix}\color{#059669}{b_{0j}}\\\color{#059669}{b_{1j}}\end{bmatrix} \sim \mathcal N\!\left(\begin{bmatrix}0\\0\end{bmatrix},\,\begin{bmatrix}\sigma^2_{b0} & \sigma_{b0b1}\\ \sigma_{b0b1} & \sigma^2_{b1}\end{bmatrix}\right)
$$

Formel (lme4): `y ~ 1 + x + (1 + x | gruppe)`

---

### 4) Blockstruktur von $\mathbf Z$ und $\mathbf b$

$$
\mathbf Z = \begin{bmatrix} \mathbf Z_1 \\ \mathbf Z_2 \\ \vdots \\ \mathbf Z_J \end{bmatrix},\quad \mathbf b = \begin{bmatrix} \mathbf b_1 \\ \mathbf b_2 \\ \vdots \\ \mathbf b_J \end{bmatrix},\quad \mathbf G = \operatorname{blockdiag}(\mathbf G_1,\dots,\mathbf G_J)
$$

Jede Gruppe $j$ erhält ihre eigenen Abweichungen $\mathbf b_j$; bei gekreuzten Designs enthält $\mathbf Z$ die Indikatoren für mehrere Gruppierungsfaktoren.

---

### 5) Von OLS zu LME – der Übergang

- **OLS:** eine globale Gerade/Ebene für alle Beobachtungen; Heterogenität steckt nur im Fehler.
- **RI:** gruppenspezifische Niveaus via $b_{0j}$ – parallele Geraden.
- **RI+RS:** zusätzlich gruppenspezifische Steigungen via $b_{1j}$ – Fächer von Geraden.
- **Matrixform:** $\mathbf Z\,\mathbf b$ ergänzt OLS und bekommt eigene Varianzstruktur.

---

### 6) Marginale Verteilung von $\mathbf y$

$$
\mathbf y \sim \mathcal N\!\big(\,\color{#374151}{\mathbf X}\,\color{#4f46e5}{\boldsymbol\beta},\; \color{#374151}{\mathbf Z}\,\mathbf G\,\color{#374151}{\mathbf Z}^{\!\top} + \mathbf R\big)
$$

Der gemischte Term induziert Korrelation innerhalb von Gruppen.

---

### 7) Bonus: GLMM (logistisch)

$$
\operatorname{logit}\,\Pr(y_{ij}=1) = \color{#4f46e5}{\beta_0}+\color{#4f46e5}{\beta_1}x_{ij}+\color{#059669}{b_{0j}}
$$

Gleiche Struktur; nur Linkfunktion und Antwortverteilung ändern sich (hier Bernoulli).













### 1. Motivation & Data Structure

When emotion ratings are collected repeatedly over time for each
participant, observations are nested within individuals. A standard
regression ignores this dependency and underestimates standard errors. A
multilevel model (also called mixed-effects model) handles:

-   Level 1 (Within-person): How emotion varies over time *for each*
    person  
-   Level 2 (Between-person): How these trajectories differ *across*
    people

Our example dataset has 3 participants (`subject = 1,2,3`), each rated
on 30 occasions (`time = 1,2,...,30`). The column `emotion` is the
outcome.

``` r
# simulate data
library(lme4)

# estimate model
#fit <- lmer(emotion ~ time + (1|id), data = data)

# View results
#summary(fit)

2+2
```

    ## [1] 4
