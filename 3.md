---
layout: page
title: Mixed-effects model
output: md_document
---

# Mixed-Effects Models – von OLS zu LME/LMM

> Formeln mit Farblegende für feste und zufällige Effekte – kompatibel mit KaTeX/MathJax.

---

### Legende
- **Feste Effekte (β)**: blau  
- **Zufällige Effekte (b)**: grün  
- **Fehler / Residuen (ε)**: rot  
- **Designmatrizen (X, Z)**: grau  

---

### 1) Klassisches lineares Modell (OLS)

\[
\underbrace{\mathbf y}_{\text{Antwort}}
= \underbrace{\color{gray}{\mathbf X}}_{\text{Design}}
\, \underbrace{\color{blue}{\boldsymbol\beta}}_{\text{feste Effekte}}
+ \underbrace{\color{red}{\boldsymbol\varepsilon}}_{\varepsilon \sim \mathcal N(\mathbf 0,\, \sigma^2\mathbf I)}
\]

Die gesamte systematische Struktur steckt in $\color{blue}{\boldsymbol\beta}$; die Varianz ist homogen: $\sigma^2$.

---

### 2) Lineares Mixed-Effects-Modell

\[
\mathbf y
= \color{gray}{\mathbf X}\,\color{blue}{\boldsymbol\beta}
+ \color{gray}{\mathbf Z}\,\color{green}{\mathbf b}
+ \color{red}{\boldsymbol\varepsilon}
\]

\[
\color{green}{\mathbf b} \sim \mathcal N(\mathbf 0, \mathbf G),
\quad
\color{red}{\boldsymbol\varepsilon} \sim \mathcal N(\mathbf 0, \mathbf R)
\]

---

### 3) Beispiele

**Zufälliger Interzept (RI):**

\[
y_{ij} = \color{blue}{\beta_0} + \color{blue}{\beta_1} x_{ij} + \color{green}{b_{0j}} + \color{red}{\varepsilon_{ij}}
\]

\[
\color{green}{b_{0j}} \sim \mathcal N(0, \sigma^2_{b0}),
\quad
\color{red}{\varepsilon_{ij}} \sim \mathcal N(0, \sigma^2)
\]

Formel (lme4): `y ~ 1 + x + (1 | gruppe)`

---

**Zufälliger Interzept & Steigung (RI+RS):**

\[
y_{ij} = (\color{blue}{\beta_0}+\color{green}{b_{0j}})
+ (\color{blue}{\beta_1}+\color{green}{b_{1j}})\,x_{ij}
+ \color{red}{\varepsilon_{ij}}
\]

\[
\begin{bmatrix}
\color{green}{b_{0j}} \\
\color{green}{b_{1j}}
\end{bmatrix}
\sim \mathcal N\!\left(
\begin{bmatrix}0\\0\end{bmatrix},\,
\begin{bmatrix}
\sigma^2_{b0} & \sigma_{b0b1} \\
\sigma_{b0b1} & \sigma^2_{b1}
\end{bmatrix}
\right)
\]

Formel (lme4): `y ~ 1 + x + (1 + x | gruppe)`

---

### 4) Blockstruktur von Z und b

\[
\mathbf Z =
\begin{bmatrix}
\mathbf Z_1 \\
\mathbf Z_2 \\
\vdots \\
\mathbf Z_J
\end{bmatrix},
\quad
\mathbf b =
\begin{bmatrix}
\mathbf b_1 \\
\mathbf b_2 \\
\vdots \\
\mathbf b_J
\end{bmatrix},
\quad
\mathbf G = \operatorname{blockdiag}(\mathbf G_1,\dots,\mathbf G_J)
\]

---

### 5) Von OLS zu LME – der Übergang

- **OLS:** eine globale Gerade/Ebene; Heterogenität steckt nur im Fehler.  
- **RI:** gruppenspezifische Niveaus via $b_{0j}$ – parallele Geraden.  
- **RI+RS:** zusätzlich gruppenspezifische Steigungen via $b_{1j}$ – Fächer von Geraden.  
- **Matrixform:** $Z b$ ergänzt OLS und bekommt eigene Varianzstruktur.  

---

### 6) Marginale Verteilung von y

\[
\mathbf y \sim \mathcal N\!\big(
\color{gray}{\mathbf X}\,\color{blue}{\boldsymbol\beta},\;
\color{gray}{\mathbf Z}\,\mathbf G\,\color{gray}{\mathbf Z}^{\!\top} + \mathbf R
\big)
\]

---

### 7) Bonus: GLMM (logistisch)

\[
\operatorname{logit}\,\Pr(y_{ij}=1) = \color{blue}{\beta_0}
+ \color{blue}{\beta_1}x_{ij}
+ \color{green}{b_{0j}}
\]

Gleiche Struktur; nur Linkfunktion und Antwortverteilung ändern sich (hier Bernoulli).











### 1. Motivation & Data Structure

When emotion ratings are collected repeatedly over time for each
participant, observations are nested within individuals. A standard
regression ignores this dependency and underestimates standard errors. A
multilevel model (also called mixed-effects model) handles:

-   Level 1 (Within-person): How emotion varies over time *for each*
    person  
-   Level 2 (Between-person): How these trajectories differ *across*
    people

Our example dataset has 3 participants (`subject = 1,2,3`), each rated
on 30 occasions (`time = 1,2,...,30`). The column `emotion` is the
outcome.

``` r
# simulate data
library(lme4)

# estimate model
#fit <- lmer(emotion ~ time + (1|id), data = data)

# View results
#summary(fit)

2+2
```

    ## [1] 4
